set drawbox
set smartcase
set ignoredia
set noanchorfind
set promptfmt "\033[34;1m%w\033[0m %f"

# ================
# Functions
# ================

# Dynamically set the number of columns
%{{
    w=$(tput cols)
    if [ $w -le 30 ]; then
      lf -remote "send $id set ratios 1"
    elif [ $w -le 80 ]; then
        lf -remote "send $id set ratios 3:2"
    else
        lf -remote "send $id set ratios 1:2:2"
    fi
}}

cmd open ${{
    # Sometimes mp3s are labeled as octet streams.
    if [ "${f##*.}" = "mp3" ]; then
        mpv --no-audio-display "$f"
    else
        case $(file --mime-type "$f" -bL) in
            text/*|application/json) nvr -s "$f";;
            application/pdf) zathura --fork "$f";;
            video/*) fork mpv --force-window=yes "$f";;
            audio/*) fork mpv --force-window=yes "$f";;
            image/*) fork ristretto "$f";;
            *) xdg-open "$f";;
        esac
    fi
}}

cmd redraw_and_reload :{{
   redraw
   reload
}}

cmd md % mkdir "$@"
cmd mkdir % mkdir "$@"

# ================
# Key Bindings
# ================

map d # unset cut
map y # unset yank
map p # unset paste
map c # unset clear
map m # unset mkdir
map \;
map \:

map <c-l> redraw_and_reload

map <space> quit
map ; read
map . set hidden!

cmd trash-one %trash-put -- "$f"

# Ugly hack. This will fail if a file name contains a newline!!!
# First, we tell the shell to split variables on newlines instead of spaces.
set ifs "\n"
cmd trash-all %trash-put -- $fx

map dd cut
map dw trash-all # issues if a file has a \n in its name
map dW trash-one
map yy copy
map pp paste; clear
map v toggle
map u :unselect; clear
map U $ trash-restore

# Deal with marks
map m mark-save
map \' mark-load
map dm mark-remove

# Rename various parts of filenames
map r :rename; cmd-word-back; cmd-left # change name
map cw :rename; cmd-delete-home # change all
map ce :rename # change extension
map R $printf "%s\n" "$fx" | vidir - # bulk rename

# Quick teleport
map gh cd ~
map gi cd ~/io
map gp cd ~/pictures
map gp cd ~/pictures
map gd cd ~/documents
map gc cd ~/code
map g/ cd /
map gm cd /mnt
map ge cd /etc
map gu cd /usr

# vim: ft=conf
